// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String        @id @default(uuid())
  tin                     String        @unique
  email                   String        @unique
  passwordHash            String
  firstName               String
  lastName                String
  businessApprovalStatus  String        @default("NONE") // NONE, PENDING, APPROVED, REJECTED
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  submissions             Submission[]
  businesses              Business[]
  simulations             Simulation[]
  transactions            Transaction[]
}

model Submission {
  id        String   @id @default(uuid())
  formData  Json
  status    String   @default("DRAFT")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  userId    String
}

enum BusinessStatus {
  PENDING
  APPROVED
  REJECTED
}

model Business {
  id              String         @id @default(uuid())
  
  // Registration Type
  registrationType String        @default("INDIVIDUAL") // INDIVIDUAL or NON_INDIVIDUAL

  // Common Fields
  businessName    String
  businessTin     String         @unique
  businessAddress String?
  businessEmail   String?
  businessContact String?
  lineOfBusiness  String?        // PSIC
  
  // Individual Specific
  ownerName       String?        // Full name of the business owner (Trade name owner)
  ownerTin        String?        // TIN of the owner
  civilStatus     String?
  citizenship     String?
  dateOfBirth     DateTime?

  // Non-Individual Specific
  organizationType String?       // Corporation, Partnership, etc.
  secRegNum       String?        // SEC or CDA Number
  dateOfRegistration DateTime?
  authorizedRep   String?        // Name of authorized representative

  // Legacy / General
  businessType    String?        // Sole proprietorship, Corporation, etc.
  businessRegNum  String?        // BIR registration number

  status          BusinessStatus @default(PENDING)
  owner           User           @relation(fields: [ownerId], references: [id])
  ownerId         String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model Simulation {
  id         String   @id @default(uuid())
  title      String?
  form       String
  data       Json
  amount     Float
  paid       Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  businessId String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Transaction {
  id         String            @id @default(uuid())
  total      Float
  date       DateTime          @default(now())
  items      TransactionItem[]
  user       User?             @relation(fields: [userId], references: [id])
  userId     String?
  createdAt  DateTime          @default(now())
}

model TransactionItem {
  id            String      @id @default(uuid())
  description   String
  amount        Float
  transaction   Transaction @relation(fields: [transactionId], references: [id])
  transactionId String
  simulationId  String?
}
